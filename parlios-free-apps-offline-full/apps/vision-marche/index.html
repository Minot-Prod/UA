<!doctype html>
<html lang="fr">
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Parlios Vision Marché — Preview Offline</title>
<link rel="stylesheet" href="../../styles/base.css"/>
<body>
<div class="container">
  <h1>Parlios Vision Marché — Preview</h1>
  <p aria-live="polite">Analyse marché → personas → plan d’action (mock-IA local, 0 API).</p>
  <div class="grid-2">
    <div>
      <label>Marché / Niche</label>
      <input id="market" placeholder="Ex: Photographes mariage à Montréal"/>
      <label>Audience / Persona</label>
      <input id="persona" placeholder="Ex: Fiancés 25-35 ans, budget moyen"/>
      <label>Période</label>
      <select id="period">
        <option>30 jours</option><option>60 jours</option><option>90 jours</option>
      </select>
      <div class="row" style="margin-top:12px">
        <button id="btn" class="primary">Analyser</button>
        <button id="btnExportJSON">Export JSON</button>
        <button id="btnExportMD">Export MD</button>
      </div>
    </div>
    <div>
      <div role="region" aria-label="Insights" class="output" id="ins"></div>
      <div role="region" aria-label="Plan d’action" class="output" id="plan" style="margin-top:12px"></div>
    </div>
  </div>
  <p><a href="../../index.html"><button>Retour au Hub</button></a></p>
</div>
<div id="toast" class="toast" role="status" aria-live="polite" hidden>
  <h4 id="tTitle">Info</h4><p id="tMsg"></p>
</div>
<script type="module">
import { generateVariants } from "../../lib/mock_ai.js";
import { exportJSON, exportMD } from "../../lib/exporters.js";
const $=s=>document.querySelector(s);
const toast=$("#toast"),t1=$("#tTitle"),t2=$("#tMsg");
function showToast(a,b){ t1.textContent=a; t2.textContent=b; toast.hidden=false; setTimeout(()=>toast.hidden=true, 2000); }
const ins=$("#ins"), plan=$("#plan");
$("#btn").addEventListener("click",()=>{
  const market=$("#market").value||"Marché local";
  const persona=$("#persona").value||"Audience cible";
  const period=$("#period").value;
  const seed=Date.now();
  const insights = generateVariants({seed,tone:"pro",goal:"generic",count:3,length:"medium"}).map((v,i)=>`• Insight ${i+1}: ${v}`);
  const actions = generateVariants({seed:seed+42,tone:"friendly",goal:"generic",count:5,length:"short"}).map((v,i)=>`- Action ${i+1}: ${v}`);
  ins.textContent = `Insights (${market} → ${persona})\n\n` + insights.join("\n");
  plan.textContent = `Plan d’action (${period})\n\n` + actions.join("\n");
  showToast("Analyse prête","Insights + plan générés");
  window.__visionLast = { market, persona, period, insights, actions };
});
$("#btnExportJSON").addEventListener("click",()=>{
  if(!window.__visionLast) return showToast("Export","Rien à exporter");
  exportJSON(`parlios-vision-marche-${Date.now()}.json`, window.__visionLast);
});
$("#btnExportMD").addEventListener("click",()=>{
  if(!window.__visionLast) return showToast("Export","Rien à exporter");
  const {market, persona, period, insights, actions}=window.__visionLast;
  exportMD(`parlios-vision-marche-${Date.now()}.md`, [
    `# Vision Marché\n\n**Marché**: ${market}\n**Persona**: ${persona}\n**Période**: ${period}`,
    `## Insights\n${insights.map(x=>x.replace('• ','- ')).join("\n")}`,
    `## Plan d’action\n${actions.join("\n")}`
  ]);
});
</script>
</body>
</html>
