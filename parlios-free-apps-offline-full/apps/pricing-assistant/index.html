<!doctype html>
<html lang="fr">
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Parlios Assistant Prix — Preview Offline</title>
<link rel="stylesheet" href="../../styles/base.css"/>
<body>
<div class="container">
  <h1>Parlios Assistant Prix — Preview</h1>
  <p aria-live="polite">Calcul simple de prix optimal et ROI (offline).</p>
  <div class="grid-2">
    <div>
      <label>Coût (CAD)</label><input id="cost" type="number" value="50"/>
      <label>Valeur perçue (1–10)</label><input id="value" type="number" value="7" min="1" max="10"/>
      <label>Positionnement (1=entrée, 10=premium)</label><input id="pos" type="number" value="6" min="1" max="10"/>
      <div class="row" style="margin-top:12px">
        <button id="btn" class="primary">Calculer</button>
        <button id="btnJSON">Export JSON</button>
      </div>
    </div>
    <div>
      <div id="out" class="output"></div>
    </div>
  </div>
  <p><a href="../../index.html"><button>Retour au Hub</button></a></p>
</div>
<script type="module">
import { fmt, clamp } from "../../lib/util.js";
import { exportJSON } from "../../lib/exporters.js";
const $=s=>document.querySelector(s);
$("#btn").addEventListener("click",()=>{
  const c = Math.max(0, Number($("#cost").value||0));
  const v = clamp(Number($("#value").value||5),1,10);
  const p = clamp(Number($("#pos").value||5),1,10);
  const margin = 0.2 + (v-5)*0.03 + (p-5)*0.04;
  const price = c * (1 + Math.max(0.1, Math.min(1.5, margin)));
  const roi = (price - c) / Math.max(1, c);
  const tiers = price < c*1.2 ? "entrée" : price < c*2 ? "milieu" : "premium";
  $("#out").textContent = `Prix recommandé: ${fmt(price)} CAD (segment: ${tiers})\nMarge estimée: ${(margin*100).toFixed(1)} %\nROI approximatif: ${(roi*100).toFixed(1)} %`;
  window.__pricingLast = { cost:c, value:v, position:p, price, margin, roi, segment:tiers };
});
$("#btnJSON").addEventListener("click",()=>{
  if(!window.__pricingLast) return;
  exportJSON(`parlios-pricing-${Date.now()}.json`, window.__pricingLast);
});
</script>
</body>
</html>
