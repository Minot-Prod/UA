# .github/workflows/deploy_deepresearch_bundle.yml
name: ðŸ§© Deploy DeepResearch Bundle v1.0.0

on:
  workflow_dispatch: # Lancement manuel
    inputs:
      auto_merge:
        description: "Activer l'auto-merge aprÃ¨s PR"
        required: false
        default: "true"

permissions:
  contents: write
  pull-requests: write
  actions: read

jobs:
  deploy:
    name: ðŸš€ Deploy DeepResearch Bundle (OPTIMIZATION + PROMPTS + MEMORY)
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ§© Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: âš™ï¸ Setup Git config
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: ðŸ“¦ Create DeepResearch bundle files
        run: |
          mkdir -p .github/workflows
          echo "${{ secrets.GH_API }}" > /dev/null # SÃ©curitÃ© : token non exposÃ©

          cat > OPTIMIZATION_PLAN.md <<'EOF'
# ðŸ§  OPTIMIZATION_PLAN.md
*(contenu complet du plan gÃ©nÃ©rÃ© prÃ©cÃ©demment ici)*
EOF

          cat > PROMPTS_PLAN.md <<'EOF'
# ðŸ§  PROMPTS_PLAN.md
*(contenu complet du plan gÃ©nÃ©rÃ© prÃ©cÃ©demment ici)*
EOF

          cat > GITHUB_MEMORY_PACK.md <<'EOF'
# ðŸ§  GITHUB_MEMORY_PACK.md
*(contenu complet du plan gÃ©nÃ©rÃ© prÃ©cÃ©demment ici)*
EOF

      - name: ðŸŒ¿ Create branch and commit
        run: |
          git checkout -b chore/deepresearch-bundle-import
          git add OPTIMIZATION_PLAN.md PROMPTS_PLAN.md GITHUB_MEMORY_PACK.md
          git commit -m "ðŸ§© Import: DeepResearch Bundle v1.0.0 (Knowledge, Automation, CI, Prompts & Memory)"

      - name: ðŸš€ Push branch to origin
        env:
          GH_TOKEN: ${{ secrets.GH_API }}
        run: |
          git push https://x-access-token:${GH_TOKEN}@github.com/${{ github.repository }} HEAD:chore/deepresearch-bundle-import

      - name: ðŸ§  Create Pull Request
        env:
          GH_TOKEN: ${{ secrets.GH_API }}
        run: |
          gh pr create \
            --base main \
            --head chore/deepresearch-bundle-import \
            --title "ðŸ§© Import: DeepResearch Bundle v1.0.0 (Knowledge, Automation, CI, Prompts & Memory)" \
            --body "Ajout automatique du bundle DeepResearch orchestrÃ© par lâ€™Agent GitHub-First (plans, workflows CI, prompts et mÃ©moire technique)."

      - name: âœ… Auto-merge PR (optionnel)
        if: ${{ github.event.inputs.auto_merge == 'true' }}
        env:
          GH_TOKEN: ${{ secrets.GH_API }}
        run: |
          gh pr merge chore/deepresearch-bundle-import --squash --delete-branch --auto
