<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Parlios — Démo Consentements</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .fade-in { animation: fadein .2s ease-in; }
    @keyframes fadein { from { opacity: 0 } to { opacity: 1 } }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <header class="p-4 border-b bg-white">
    <div class="max-w-5xl mx-auto flex items-center justify-between">
      <h1 class="text-xl font-semibold">Parlios — Démo Consentements</h1>
      <a href="#privacy" id="openPrivacy" class="text-sm underline">Confidentialité</a>
    </div>
  </header>

  <main class="max-w-5xl mx-auto p-6">
    <p class="mb-4">Essaie la bannière : accepte, refuse, ou personnalise.</p>
    <pre id="state" class="p-3 bg-white border rounded text-sm overflow-x-auto"></pre>
  </main>

  <!-- Banner -->
  <div id="banner" class="fixed inset-x-0 bottom-0 bg-white border-t shadow fade-in">
    <div class="max-w-5xl mx-auto p-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
      <p class="text-sm md:max-w-[70%]">
        Parlios utilise uniquement ce qui est nécessaire. Active les options “Analytics” et “IA” si tu es d’accord (opt‑in). Tu peux refuser tout.
      </p>
      <div class="flex gap-2">
        <button id="btnReject" class="px-3 py-2 text-sm border rounded">Refuser tout</button>
        <button id="btnCustomize" class="px-3 py-2 text-sm border rounded">Personnaliser</button>
        <button id="btnAccept" class="px-3 py-2 text-sm bg-slate-900 text-white rounded">Accepter tout</button>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div id="modal" class="fixed inset-0 bg-black/40 hidden items-center justify-center fade-in" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="bg-white rounded-xl shadow max-w-lg w-full p-4">
      <div class="flex items-center justify-between">
        <h2 id="modalTitle" class="text-lg font-semibold">Confidentialité & consentements</h2>
        <button id="modalClose" class="text-sm underline">Fermer</button>
      </div>
      <p class="text-sm mt-2">Tu as le contrôle. Rien de non essentiel n’est activé sans ton accord.</p>
      <div class="mt-4 grid gap-3">
        <label class="flex items-center gap-2"><input id="cAnalytics" type="checkbox"> <span>Analytics (opt‑in)</span></label>
        <label class="flex items-center gap-2"><input id="cAI" type="checkbox"> <span>IA (opt‑in)</span></label>
        <label class="flex items-center gap-2"><input checked disabled type="checkbox"> <span>Session (essentiel)</span></label>
        <label class="flex items-center gap-2"><input checked disabled type="checkbox"> <span>Sécurité (essentiel)</span></label>
      </div>
      <div class="mt-4 flex items-center justify-between">
        <div class="text-xs">
          <a class="underline" href="privacy.html" target="_blank">Politique de confidentialité</a> ·
          <a class="underline" href="legal.html" target="_blank">Mentions légales</a>
        </div>
        <div class="flex gap-2">
          <button id="modalReject" class="px-3 py-2 text-sm border rounded">Refuser tout</button>
          <button id="modalSave" class="px-3 py-2 text-sm bg-slate-900 text-white rounded">Enregistrer</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const K = "parlios.consent.v1";
    const EXPIRE_DAYS = 90;
    const qs = s => document.querySelector(s);
    const banner = qs('#banner');
    const modal = qs('#modal');

    function loadConsent() {
      try { return JSON.parse(localStorage.getItem(K)) || null } catch { return null }
    }
    function saveConsent(v) {
      const data = {{}};
      data.version = 1;
      data.updated_at = new Date().toISOString();
      data.scopes = v.scopes;
      data.expires_at = new Date(Date.now() + EXPIRE_DAYS*24*3600*1000).toISOString();
      localStorage.setItem(K, JSON.stringify(data));
    }
    function setStateText() { qs('#state').textContent = JSON.stringify(loadConsent(), null, 2) }

    function acceptAll() {
      saveConsent({{scopes: {{analytics: true, ai: true, session: true, security: true}}}});
      banner.remove();
      setStateText();
    }
    function rejectAll() {
      saveConsent({{scopes: {{analytics: false, ai: false, session: true, security: true}}}});
      banner.remove();
      setStateText();
    }
    function openCustomize() { modal.classList.remove('hidden'); modal.classList.add('flex') }
    function closeCustomize() { modal.classList.add('hidden'); modal.classList.remove('flex') }

    // Wire UI
    qs('#btnAccept').addEventListener('click', acceptAll);
    qs('#btnReject').addEventListener('click', rejectAll);
    qs('#btnCustomize').addEventListener('click', openCustomize);
    qs('#modalClose').addEventListener('click', closeCustomize);
    qs('#modalReject').addEventListener('click', () => {{ rejectAll(); closeCustomize(); }});
    qs('#modalSave').addEventListener('click', () => {{
      const v = {{
        analytics: qs('#cAnalytics').checked,
        ai: qs('#cAI').checked,
        session: true,
        security: true
      }};
      saveConsent({{scopes: v}});
      banner.remove();
      closeCustomize();
      setStateText();
    }});
    qs('#openPrivacy').addEventListener('click', (e) => {{ e.preventDefault(); openCustomize(); }});

    // Init
    const existing = loadConsent();
    if (existing) banner.remove();
    setStateText();
  </script>
</body>
</html>
